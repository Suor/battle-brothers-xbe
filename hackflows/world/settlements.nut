local towns = ::HackflowsExp.Data.SettlementDrafts <- {
    city_state = [
        "hackflows/master_archer_background"
        "hackflows/master_archer_background"
        "hackflows/master_archer_background"
        "hackflows/myrmidon_background"
        "hackflows/myrmidon_background"
        "hackflows/myrmidon_background"
        "hackflows/myrmidon_background"
        "hackflows/folk_hero_background"
        "hackflows/champion_background"
        "hackflows/champion_background"
        "hackflows/berserker_background"
        "hackflows/berserker_background"
        "hackflows/lancer_background"
        "hackflows/lancer_background"
        "hackflows/bodyguard_background"
        "hackflows/bodyguard_background"
        "hackflows/bodyguard_background"
        "hackflows/bounty_hunter_background"
        "hackflows/bounty_hunter_background"
        "hackflows/bounty_hunter_background"
        "hackflows/bounty_hunter_background"
        "hackflows/bounty_hunter_background"
        "hackflows/cobbler_background"
        "hackflows/cook_background"
        "hackflows/herbalist_background"
        "hackflows/skirmisher_background"
        "hackflows/torturer_background"
    ]
    large_coast_fort = [
        "hackflows/arbalester_background"
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/barkeep_background"
        "hackflows/blacksmith_background"
        "hackflows/bodyguard_background"
        "hackflows/bounty_hunter_background"
        "hackflows/cartographer_background"
        "hackflows/cobbler_background"
        "hackflows/con_artist_background"
        "hackflows/cook_background"
        "hackflows/dissenter_background"
        "hackflows/drifter_background"
        "hackflows/fletcher_background"
        "hackflows/gardener_background"
        "hackflows/hangman_background"
        "hackflows/lancer_background"
        "hackflows/locksmith_background"
        "hackflows/master_archer_background"
        "hackflows/myrmidon_background"
        "hackflows/myrmidon_background"
        "hackflows/painter_background"
        "hackflows/pirate_background"
        "hackflows/pirate_background"
        "hackflows/roofer_background"
        "hackflows/skirmisher_background"
        "hackflows/surgeon_background"
        "hackflows/torturer_background"
        "hackflows/town_watchman_background"
    ]
    large_farm_fort = [
        "hackflows/arbalester_background"
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/barkeep_background"
        "hackflows/blacksmith_background"
        "hackflows/bodyguard_background"
        "hackflows/bounty_hunter_background"
        "hackflows/cartographer_background"
        "hackflows/cobbler_background"
        "hackflows/con_artist_background"
        "hackflows/cook_background"
        "hackflows/dissenter_background"
        "hackflows/drifter_background"
        "hackflows/fletcher_background"
        "hackflows/gardener_background"
        "hackflows/hangman_background"
        "hackflows/lancer_background"
        "hackflows/locksmith_background"
        "hackflows/master_archer_background"
        "hackflows/painter_background"
        "hackflows/roofer_background"
        "hackflows/roofer_background"
        "hackflows/skirmisher_background"
        "hackflows/surgeon_background"
        "hackflows/torturer_background"
        "hackflows/town_watchman_background"
    ]
    large_farming_village = [
        "hackflows/cartographer_background"
        "hackflows/cook_background"
        "hackflows/cobbler_background"
        "hackflows/hangman_background"
        "hackflows/herbalist_background"
        "hackflows/locksmith_background"
        "hackflows/town_watchman_background"
    ]
    large_fishing_village = [
        "hackflows/cartographer_background"
        "hackflows/cook_background"
        "hackflows/cobbler_background"
        "hackflows/con_artist_background"
        "hackflows/dissenter_background"
        "hackflows/drifter_background"
        "hackflows/leper_background"
        "hackflows/myrmidon_background"
        "hackflows/painter_background"
        "hackflows/town_watchman_background"
    ]
    large_forest_fort = [
        "hackflows/atilliator_background"
        "hackflows/barkeep_background"
        "hackflows/berserker_background"
        "hackflows/blacksmith_background"
        "hackflows/bodyguard_background"
        "hackflows/carpenter_background"
        "hackflows/carpenter_background"
        "hackflows/cartographer_background"
        "hackflows/cobbler_background"
        "hackflows/con_artist_background"
        "hackflows/cook_background"
        "hackflows/dissenter_background"
        "hackflows/drifter_background"
        "hackflows/druid_background"
        "hackflows/falconer_background"
        "hackflows/falconer_background"
        "hackflows/fletcher_background"
        "hackflows/fletcher_background"
        "hackflows/gardener_background"
        "hackflows/gardener_background"
        "hackflows/hangman_background"
        "hackflows/herbalist_background"
        "hackflows/lancer_background"
        "hackflows/locksmith_background"
        "hackflows/master_archer_background"
        "hackflows/master_archer_background"
        "hackflows/painter_background"
        "hackflows/roofer_background"
        "hackflows/skirmisher_background"
        "hackflows/skirmisher_background"
        "hackflows/surgeon_background"
        "hackflows/torturer_background"
        "hackflows/town_watchman_background"
    ]
    large_lumber_village = [
        "hackflows/atilliator_background"
        "hackflows/atilliator_background"
        "hackflows/berserker_background"
        "hackflows/carpenter_background"
        "hackflows/carpenter_background"
        "hackflows/cartographer_background"
        "hackflows/cobbler_background"
        "hackflows/con_artist_background"
        "hackflows/dissenter_background"
        "hackflows/drifter_background"
        "hackflows/druid_background"
        "hackflows/fletcher_background"
        "hackflows/gardener_background"
        "hackflows/painter_background"
        "hackflows/roofer_background"
        "hackflows/skirmisher_background"
        "hackflows/skirmisher_background"
        "hackflows/town_watchman_background"
    ]
    large_mountains_fort = [
        "hackflows/arbalester_background"
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/berserker_background"
        "hackflows/blacksmith_background"
        "hackflows/bodyguard_background"
        "hackflows/bodyguard_background"
        "hackflows/bounty_hunter_background"
        "hackflows/cartographer_background"
        "hackflows/cobbler_background"
        "hackflows/con_artist_background"
        "hackflows/cook_background"
        "hackflows/dissenter_background"
        "hackflows/drifter_background"
        "hackflows/druid_background"
        "hackflows/hangman_background"
        "hackflows/lancer_background"
        "hackflows/lancer_background"
        "hackflows/locksmith_background"
        "hackflows/master_archer_background"
        "hackflows/roofer_background"
        "hackflows/roofer_background"
        "hackflows/skirmisher_background"
        "hackflows/surgeon_background"
        "hackflows/torturer_background"
        "hackflows/town_watchman_background"
    ]
    large_snow_fort = [
        "hackflows/arbalester_background"
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/berserker_background"
        "hackflows/berserker_background"
        "hackflows/blacksmith_background"
        "hackflows/bodyguard_background"
        "hackflows/bodyguard_background"
        "hackflows/bounty_hunter_background"
        "hackflows/cartographer_background"
        "hackflows/cobbler_background"
        "hackflows/dissenter_background"
        "hackflows/drifter_background"
        "hackflows/druid_background"
        "hackflows/fletcher_background"
        "hackflows/hangman_background"
        "hackflows/herbalist_background"
        "hackflows/lancer_background"
        "hackflows/locksmith_background"
        "hackflows/master_archer_background"
        "hackflows/myrmidon_background"
        "hackflows/myrmidon_background"
        "hackflows/painter_background"
        "hackflows/roofer_background"
        "hackflows/roofer_background"
        "hackflows/skirmisher_background"
        "hackflows/surgeon_background"
        "hackflows/torturer_background"
        "hackflows/town_watchman_background"
    ]
    large_snow_village = [
        "hackflows/atilliator_background"
        "hackflows/berserker_background"
        "hackflows/berserker_background"
        "hackflows/bounty_hunter_background"
        "hackflows/cartographer_background"
        "hackflows/cobbler_background"
        "hackflows/cook_background"
        "hackflows/dissenter_background"
        "hackflows/drifter_background"
        "hackflows/druid_background"
        "hackflows/fletcher_background"
        "hackflows/herbalist_background"
        "hackflows/master_archer_background"
        "hackflows/myrmidon_background"
        "hackflows/roofer_background"
        "hackflows/roofer_background"
        "hackflows/skirmisher_background"
        "hackflows/town_watchman_background"
    ]
    large_steppe_fort = [
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/blacksmith_background"
        "hackflows/bodyguard_background"
        "hackflows/bodyguard_background"
        "hackflows/bounty_hunter_background"
        "hackflows/cobbler_background"
        "hackflows/cook_background"
        "hackflows/dissenter_background"
        "hackflows/dissenter_background"
        "hackflows/drifter_background"
        "hackflows/drifter_background"
        "hackflows/fletcher_background"
        "hackflows/gardener_background"
        "hackflows/hangman_background"
        "hackflows/lancer_background"
        "hackflows/locksmith_background"
        "hackflows/master_archer_background"
        "hackflows/myrmidon_background"
        "hackflows/myrmidon_background"
        "hackflows/roofer_background"
        "hackflows/skirmisher_background"
        "hackflows/skirmisher_background"
        "hackflows/town_watchman_background"
    ]
    large_steppe_village = [
        "hackflows/atilliator_background"
        "hackflows/bodyguard_background"
        "hackflows/cartographer_background"
        "hackflows/cobbler_background"
        "hackflows/cobbler_background"
        "hackflows/con_artist_background"
        "hackflows/cook_background"
        "hackflows/dissenter_background"
        "hackflows/drifter_background"
        "hackflows/fletcher_background"
        "hackflows/locksmith_background"
        "hackflows/master_archer_background"
        "hackflows/painter_background"
        "hackflows/roofer_background"
        "hackflows/skirmisher_background"
        "hackflows/skirmisher_background"
        "hackflows/surgeon_background"
        "hackflows/torturer_background"
        "hackflows/town_watchman_background"
    ]
    large_swamp_village = [
        "hackflows/bounty_hunter_background"
        "hackflows/cartographer_background"
        "hackflows/cobbler_background"
        "hackflows/dissenter_background"
        "hackflows/drifter_background"
        "hackflows/herbalist_background"
        "hackflows/locksmith_background"
        "hackflows/master_archer_background"
        "hackflows/roofer_background"
        "hackflows/skirmisher_background"
        "hackflows/town_watchman_background"
    ]
    large_tundra_fort = [
        "hackflows/arbalester_background"
        "hackflows/arbalester_background"
        "hackflows/berserker_background"
        "hackflows/blacksmith_background"
        "hackflows/bodyguard_background"
        "hackflows/bodyguard_background"
        "hackflows/bounty_hunter_background"
        "hackflows/cartographer_background"
        "hackflows/dissenter_background"
        "hackflows/drifter_background"
        "hackflows/druid_background"
        "hackflows/fletcher_background"
        "hackflows/hangman_background"
        "hackflows/lancer_background"
        "hackflows/lancer_background"
        "hackflows/locksmith_background"
        "hackflows/master_archer_background"
        "hackflows/roofer_background"
        "hackflows/roofer_background"
        "hackflows/surgeon_background"
        "hackflows/torturer_background"
        "hackflows/town_watchman_background"
    ]
    large_tundra_village = [
        "hackflows/cartographer_background"
        "hackflows/cobbler_background"
        "hackflows/con_artist_background"
        "hackflows/dissenter_background"
        "hackflows/drifter_background"
        "hackflows/master_archer_background"
        "hackflows/myrmidon_background"
        "hackflows/myrmidon_background"
        "hackflows/painter_background"
        "hackflows/roofer_background"
        "hackflows/roofer_background"
        "hackflows/town_watchman_background"
    ]
    medium_coast_fort = [
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/cartographer_background"
        "hackflows/con_artist_background"
        "hackflows/dissenter_background"
        "hackflows/myrmidon_background"
        "hackflows/roofer_background"
        "hackflows/town_watchman_background"
    ]
    medium_farm_fort = [
        "hackflows/arbalester_background"
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/con_artist_background"
        "hackflows/dissenter_background"
        "hackflows/town_watchman_background"
    ]
    medium_farming_village = [
        "hackflows/con_artist_background"
        "hackflows/town_watchman_background"
    ]
    medium_fishing_village = [
        "hackflows/cartographer_background"
        "hackflows/town_watchman_background"
    ]
    medium_forest_fort = [
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/berserker_background"
        "hackflows/carpenter_background"
        "hackflows/dissenter_background"
        "hackflows/falconer_background"
        "hackflows/fletcher_background"
        "hackflows/town_watchman_background"
    ]
    medium_lumber_village = [
        "hackflows/atilliator_background"
        "hackflows/berserker_background"
        "hackflows/carpenter_background"
        "hackflows/carpenter_background"
        "hackflows/falconer_background"
        "hackflows/fletcher_background"
        "hackflows/town_watchman_background"
    ]
    medium_mining_village = [
        "hackflows/con_artist_background"
        "hackflows/roofer_background"
        "hackflows/town_watchman_background"
    ]
    medium_mountains_fort = [
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/cartographer_background"
        "hackflows/con_artist_background"
        "hackflows/dissenter_background"
        "hackflows/hangman_background"
        "hackflows/town_watchman_background"
    ]
    medium_snow_fort = [
        "hackflows/arbalester_background"
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/berserker_background"
        "hackflows/berserker_background"
        "hackflows/bodyguard_background"
        "hackflows/roofer_background"
        "hackflows/town_watchman_background"
    ]
    medium_snow_village = [
        "hackflows/con_artist_background"
        "hackflows/roofer_background"
        "hackflows/town_watchman_background"
    ]
    medium_steppe_fort = [
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/bodyguard_background"
        "hackflows/dissenter_background"
        "hackflows/skirmisher_background"
        "hackflows/town_watchman_background"
    ]
    medium_steppe_village = [
        "hackflows/cartographer_background"
        "hackflows/con_artist_background"
        "hackflows/myrmidon_background"
        "hackflows/skirmisher_background"
        "hackflows/town_watchman_background"
    ]
    medium_swamp_fort = [
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/bounty_hunter_background"
        "hackflows/cartographer_background"
        "hackflows/dissenter_background"
        "hackflows/herbalist_background"
        "hackflows/town_watchman_background"
    ]
    medium_swamp_village = [
        "hackflows/cartographer_background"
        "hackflows/herbalist_background"
        "hackflows/myrmidon_background"
        "hackflows/town_watchman_background"
    ]
    medium_tundra_fort = [
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/berserker_background"
        "hackflows/dissenter_background"
        "hackflows/town_watchman_background"
    ]
    medium_tundra_village = [
        "hackflows/carpenter_background"
        "hackflows/myrmidon_background"
        "hackflows/town_watchman_background"
    ]
    small_coast_fort = [
        "hackflows/atilliator_background"
        "hackflows/town_watchman_background"
    ]
    small_farm_fort = [
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/town_watchman_background"
    ]
    small_farming_village = [
        "hackflows/town_watchman_background"
    ]
    small_fishing_village = [
        "hackflows/town_watchman_background"
    ]
    small_forest_fort = [
        "hackflows/arbalester_background"
        "hackflows/carpenter_background"
        "hackflows/dissenter_background"
        "hackflows/fletcher_background"
        "hackflows/town_watchman_background"
    ]
    small_lumber_village = [
        "hackflows/carpenter_background"
        "hackflows/carpenter_background"
        "hackflows/town_watchman_background"
    ]
    small_mining_village = [
        "hackflows/town_watchman_background"
    ]
    small_mountains_fort = [
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/cartographer_background"
        "hackflows/town_watchman_background"
    ]
    small_snow_fort = [
        "hackflows/atilliator_background"
        "hackflows/dissenter_background"
        "hackflows/town_watchman_background"
    ]
    small_snow_village = [
        "hackflows/town_watchman_background"
    ]
    small_steppe_fort = [
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/dissenter_background"
        "hackflows/town_watchman_background"
    ]
    small_steppe_village = [
        "hackflows/con_artist_background"
        "hackflows/town_watchman_background"
    ]
    small_swamp_fort = [
        "hackflows/arbalester_background"
        "hackflows/dissenter_background"
        "hackflows/herbalist_background"
        "hackflows/leper_background"
        "hackflows/town_watchman_background"
    ]
    small_swamp_village = [
        "hackflows/herbalist_background"
        "hackflows/leper_background"
        "hackflows/town_watchman_background"
    ]
    small_tundra_fort = [
        "hackflows/arbalester_background"
        "hackflows/atilliator_background"
        "hackflows/town_watchman_background"
    ]
    small_tundra_village = [
        "hackflows/carpenter_background"
        "hackflows/town_watchman_background"
    ]
}

// We defined data on include so that any other mod might change/update this before we patch
::mods_queue(::HackflowsExp.ID, "mod_hooks(>=20)", function() {
    ::mods_hookDescendants("entity/world/settlement", function (cls) {
        cls.hackflows_isSettlement <- true;
    })
    ::mods_addHook("inherit", function (baseScript, script, cls) {
        if (!("hackflows_isSettlement" in cls)) return;

        local name = split(script, "/").top();
        local backgrounds = name in towns ? towns[name] : [];
        if (backgrounds.len() == 0) return;
        this.logInfo("hx: hook town " + name + " dl=" + ("onUpdateDraftList" in cls));

        local create = cls.create;
        cls.create = function () {
            create();
            this.m.DraftList.extend(backgrounds);
        }
    })
})
